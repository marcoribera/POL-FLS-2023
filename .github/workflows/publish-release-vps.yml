name: Compile scripts

on: workflow_dispatch

jobs:
  release:
    name: Compile scripts
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
      with:
        fetch-depth: 0 # avoid shallow clone so nbgv can do its work.
    - name: Compilação no servidor
      uses: appleboy/ssh-action@v1.0.3
      with:
        host: ${{ secrets.HOST }}
        username: ${{ secrets.USERNAME }}
        password: ${{ secrets.PASSWORD }}
        port: ${{ secrets.PORT }}
        script: |
          if [ -f /POL-FLS-2023/workflow_lock ]; then
            echo "Workflow is already running. Exiting."
            exit 1
          else
            touch /POL-FLS-2023/workflow_lock
            cd POL-FLS-2023
            git pull
            ./compilar.sh
            rm -f /POL-FLS-2023/workflow_lock
          fi